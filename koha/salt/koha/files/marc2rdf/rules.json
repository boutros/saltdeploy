[
  {
    "id": "18557b61-85d3-49fb-af6c-4a5e94dc31d5",
    "type": "local",
    "tag": "foaf:name",
    "name": "normalize",
    "description": "Normalize creatornames and create foaf:name and firstName and lastName",
    "start_time": "",
    "frequency": "",
    "script": "SPARQL\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX radatana: <http://def.bibsys.no/xmlns/radatana/1.0#>\n\nINSERT INTO DEFAULT_GRAPH { \n?creator foaf:lastName `bif:left(str(?catalogueName), bif:strchr(str(?catalogueName), ','))`  ;\n  foaf:firstName `bif:trim(bif:subseq(str(?catalogueName), bif:strchr(str(?catalogueName), ',') + 1))` ;\n  foaf:name `bif:trim(bif:concat(bif:subseq(str(?catalogueName), bif:strchr(str(?catalogueName), ',') + 1), ' ', bif:left(str(?catalogueName), bif:strchr(str(?catalogueName), ','))))` .\n}\nWHERE {\n  GRAPH DEFAULT_GRAPH {\n    ?creator a foaf:Person ;\n      radatana:catalogueName ?catalogueName .\n    FILTER(bif:strcontains(?catalogueName, ',')) .\n    FILTER NOT EXISTS {?creator foaf:name ?name}\n  }\n};\n\n\n\nSPARQL\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX radatana: <http://def.bibsys.no/xmlns/radatana/1.0#>\n\nINSERT INTO DEFAULT_GRAPH { \n  ?creator foaf:name ?catalogueName . \n}\nWHERE { \nGRAPH DEFAULT_GRAPH {\n  ?creator a foaf:Person ;\n    radatana:catalogueName ?catalogueName .\n  FILTER NOT EXISTS { ?creator foaf:name ?name }\n  }\n};"
  },
  {
    "id": "be6c403e-5f48-4296-b0d1-0069a0247efa",
    "type": "local",
    "tag": "deichmanworks",
    "name": "Deichman works",
    "description": "Creates and links works for Deichman library",
    "start_time": "",
    "frequency": "",
    "script": "/*\n1\n verk fra manifestasjoner UTEN originaltittel (dvs. IKKE oversatt)\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n`iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?titleURLized)))` a fabio:Work ;\n   dct:title ?title ;\n   fabio:hasManifestation ?book .\n?book a fabio:Manifestation ;\n   fabio:isManifestationOf `iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?titleURLized)))` . }\n\nWHERE { GRAPH DEFAULT_GRAPH\n   {{ SELECT sum(xsd:int(?id)) as ?sum ?titleURLized ?title ?book  WHERE\n     { ?book a bibo:Document ;\n          dct:title ?title ;\n          deich:titleURLized ?titleURLized ;\n          dct:creator ?creator .\n       ?creator dct:identifier ?id . \n       MINUS { ?book deich:originalTitle ?originalTitle }\n     }\n   }}\n};\n\n\n/*\n2\n  verk fra manifestasjoner MED originaltittel \n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n`iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?originalTitleURLized)))` a fabio:Work ;\n   dct:title ?originalTitle ;\n   fabio:hasManifestation ?book .\n?book a fabio:Manifestation ;\n   fabio:isManifestationOf `iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?originalTitleURLized)))` . }\n\nWHERE { GRAPH DEFAULT_GRAPH\n   {{ SELECT sum(xsd:int(?id)) as ?sum ?originalTitleURLized ?originalTitle ?book  WHERE\n     { ?book a bibo:Document ;\n          deich:originalTitle ?originalTitle ;\n          deich:originalTitleURLized ?originalTitleURLized ;\n          dct:creator ?creator .\n       ?creator dct:identifier ?id .\n     }\n   }}\n};\n\n\n/*\n3\n  verk fra manifestasjoner UTEN originaltittel (dvs. IKKE oversatt)\n  manifestasjoner uten dct:creator, med bibo:director\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n`iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?titleURLized)))` a fabio:Work ;\n   dct:title ?title ;\n   fabio:hasManifestation ?book .\n?book a fabio:Manifestation ;\n   fabio:isManifestationOf `iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?titleURLized)))` . }\n\nWHERE { GRAPH DEFAULT_GRAPH\n   {{ SELECT sum(xsd:int(?id)) as ?sum ?titleURLized ?title ?book  WHERE\n     { ?book a bibo:Document ;\n          dct:title ?title ;\n          deich:titleURLized ?titleURLized ;\n          bibo:director ?director .\n       ?director dct:identifier ?id . \n       MINUS { ?book dct:creator ?creator . }\n       MINUS { ?book deich:originalTitle ?originalTitle . }\n     }\n   }}\n};\n\n\n/*\n4\n  verk fra manifestasjoner MED originaltittel\n  manifestasjoner uten dct:creator, med bibo:director\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n`iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?originalTitleURLized)))` a fabio:Work ;\n   dct:title ?originalTitle ;\n   fabio:hasManifestation ?book .\n?book a fabio:Manifestation ;\n   fabio:isManifestationOf `iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?originalTitleURLized)))` . }\n\nWHERE { GRAPH DEFAULT_GRAPH\n   {{ SELECT sum(xsd:int(?id)) as ?sum ?originalTitleURLized ?originalTitle ?book  WHERE\n     { ?book a bibo:Document ;\n          deich:originalTitle ?originalTitle ;\n          deich:originalTitleURLized ?originalTitleURLized ;\n          bibo:director ?director .\n       ?director dct:identifier ?id . \n       MINUS { ?book dct:creator ?creator . }\n     }\n   }}\n};\n\n\n/*\n5\n  verk fra manifestasjoner UTEN originaltittel (dvs. IKKE oversatt)\n  manifestasjoner uten dct:creator og bibo:director, med bibo:editor\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n`iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?titleURLized)))` a fabio:Work ;\n   dct:title ?title ;\n   fabio:hasManifestation ?book .\n?book a fabio:Manifestation ;\n   fabio:isManifestationOf `iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?titleURLized)))` . }\n\nWHERE { GRAPH DEFAULT_GRAPH\n   {{ SELECT sum(xsd:int(?id)) as ?sum ?titleURLized ?title ?book  WHERE\n     { ?book a bibo:Document ;\n          dct:title ?title ;\n          deich:titleURLized ?titleURLized ;\n          bibo:editor ?editor .\n       ?editor dct:identifier ?id . \n       MINUS { ?book dct:creator ?creator . }\n       MINUS { ?book bibo:director ?director . }\n       MINUS { ?book deich:originalTitle ?originalTitle . }\n     }\n   }}\n};\n\n\n/*\n6\n  verk fra manifestasjoner MED originaltittel\n  manifestasjoner uten dct:creator og bibo:director, med bibo:editor\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n`iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?originalTitleURLized)))` a fabio:Work ;\n   dct:title ?originalTitle ;\n   fabio:hasManifestation ?book .\n?book a fabio:Manifestation ;\n   fabio:isManifestationOf `iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?originalTitleURLized)))` . }\n\nWHERE { GRAPH DEFAULT_GRAPH\n   {{ SELECT sum(xsd:int(?id)) as ?sum ?originalTitleURLized ?originalTitle ?book  WHERE\n     { ?book a bibo:Document ;\n          deich:originalTitle ?originalTitle ;\n          deich:originalTitleURLized ?originalTitleURLized ;\n          bibo:editor ?editor .\n       ?editor dct:identifier ?id . \n       MINUS { ?book dct:creator ?creator . }\n       MINUS { ?book bibo:director ?director . }\n     }\n   }}\n};\n\n\n/*\n7\n  verk fra manifestasjoner UTEN originaltittel (dvs. IKKE oversatt)\n  manifestasjoner uten dct:creator, bibo:director og bibo:editor, med dct:contributor\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n`iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?titleURLized)))` a fabio:Work ;\n   dct:title ?title ;\n   fabio:hasManifestation ?book .\n?book a fabio:Manifestation ;\n   fabio:isManifestationOf `iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?titleURLized)))` . }\n\nWHERE { GRAPH DEFAULT_GRAPH\n   {{ SELECT sum(xsd:int(?id)) as ?sum ?titleURLized ?title ?book  WHERE\n     { ?book a bibo:Document ;\n          dct:title ?title ;\n          deich:titleURLized ?titleURLized ;\n          dct:contributor ?contributor .\n       ?contributor dct:identifier ?id . \n       MINUS { ?book dct:creator ?creator . }\n       MINUS { ?book bibo:director ?director . }\n       MINUS { ?book bibo:editor ?editor . }\n       MINUS { ?book deich:originalTitle ?originalTitle . }\n     }\n   }}\n};\n\n\n/*\n8\n  verk fra manifestasjoner MED originaltittel\n  manifestasjoner uten dct:creator, bibo:director og bibo:editor, med dct:contributor\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n`iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?originalTitleURLized)))` a fabio:Work ;\n   dct:title ?originalTitle ;\n   fabio:hasManifestation ?book .\n?book a fabio:Manifestation ;\n   fabio:isManifestationOf `iri(bif:concat(\"http://data.deichman.no/work/x\", str(?sum), \"_\", str(?originalTitleURLized)))` . }\n\nWHERE { GRAPH DEFAULT_GRAPH\n   {{ SELECT sum(xsd:int(?id)) as ?sum ?originalTitleURLized ?originalTitle ?book  WHERE\n     { ?book a bibo:Document ;\n          deich:originalTitle ?originalTitle ;\n          deich:originalTitleURLized ?originalTitleURLized ;\n          dct:contributor ?contributor .\n       ?contributor dct:identifier ?id . \n       MINUS { ?book dct:creator ?creator . }\n       MINUS { ?book bibo:director ?director . }\n       MINUS { ?book bibo:editor ?editor . }\n     }\n   }}\n};\n\n\n/*\n9\n  Knytt creator til verk\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n?work dct:creator ?creator . }\n   \nWHERE { GRAPH DEFAULT_GRAPH {\n?book a bibo:Document ;\n   fabio:isManifestationOf ?work ;\n   dct:creator ?creator .\n?work fabio:hasManifestation ?book .\nMINUS {?work dct:creator ?creator .} }\n};\n\n\n/*\n10\n  Knytt director til verk\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n?work bibo:director ?director . }\n   \nWHERE { GRAPH DEFAULT_GRAPH {\n?book a bibo:Document ;\n   fabio:isManifestationOf ?work ;\n   bibo:director ?director .\n?work fabio:hasManifestation ?book .\nMINUS {?book dct:creator ?creator . }\nMINUS {?work bibo:director ?director .} }\n};\n\n\n/*\n11\n  Knytt editor til verk\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n?work bibo:editor ?editor. }\n   \nWHERE { GRAPH DEFAULT_GRAPH {\n?book a bibo:Document ;\n   fabio:isManifestationOf ?work ;\n   bibo:editor ?editor .\n?work fabio:hasManifestation ?book .\nMINUS {?book dct:creator ?creator . }\nMINUS {?book bibo:director ?director . }\nMINUS {?work bibo:editor ?editor . }}\n};\n\n\n/*\n12\n  Knytt contributor til verk\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n?work dct:contributor ?contributor. }\n   \nWHERE { GRAPH DEFAULT_GRAPH {\n?book a bibo:Document ;\n   fabio:isManifestationOf ?work ;\n   dct:contributor ?contributor .\n?work fabio:hasManifestation ?book .\nMINUS {?book dct:creator ?creator . }\nMINUS {?book bibo:director ?director . }\nMINUS {?book bibo:editor ?editor . }\nMINUS {?work dct:contributor ?contributor . }}\n};\n\n\n/*\n13\n  Knytt ISBN til verk\n*/\n\nSPARQL \nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX fabio: <http://purl.org/spar/fabio/>\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX deich: <http://data.deichman.no/>\n\nINSERT INTO DEFAULT_GRAPH { \n?work bibo:isbn ?isbn . }\n   \nWHERE { GRAPH DEFAULT_GRAPH {\n?book a bibo:Document ;\n   fabio:isManifestationOf ?work ;\n   bibo:isbn ?isbn .\n?work fabio:hasManifestation ?book .\nMINUS {?work bibo:isbn ?isbn .} }\n};"
  },

  {
    "id": "ec14e639-8b7c-46d8-b7c5-fbb8b60ef9f4",
    "type": "local",
    "tag": "languagedata",
    "name": "Language data",
    "description": "Improves data about languages",
    "start_time": "",
    "frequency": "",
    "script": "/* Legger til generell språkkode 'nor' (norsk) på dokumenter som har 'nob' (bokmål) eller 'nno' (nynorsk) */\n\nSPARQL\nPREFIX bibo: <http://purl.org/ontology/bibo/>\nPREFIX lexvo: <http://lexvo.org/id/iso639-3/>\n\nINSERT INTO DEFAULT_GRAPH {\n ?s ?p lexvo:nor .\n} WHERE {\n GRAPH DEFAULT_GRAPH {\n  ?s a bibo:Document .\n  {?s ?p lexvo:nob .}\n   UNION\n  {?s ?p lexvo:nno .}\n  MINUS {?s ?p lexvo:nor .}\n }\n};\n\n\n/* Fjerner språkkode 'mul' (flerspråklig) når andre språkkoder er angitt */\n\nSPARQL\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX lexvo: <http://lexvo.org/id/iso639-3/>\n\nDELETE FROM DEFAULT_GRAPH {\n ?s dct:language lexvo:mul .\n} WHERE {\n GRAPH DEFAULT_GRAPH {\n  ?s dct:language lexvo:mul ;\n   dct:language ?lang .\n  filter (?lang != lexvo:mul)\n }\n};"
  },
  {
    "id": "3fab3ba7-cba7-4cb2-8cc8-b38620830253",
    "type": "global",
    "tag": "foaf:name",
    "name": "creatorname (SLOW)",
    "description": "Normalize creatornames and create foaf:name and firstName and lastName for ALL graphs",
    "start_time": "",
    "frequency": "",
    "script": "SPARQL\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX radatana: <http://def.bibsys.no/xmlns/radatana/1.0#>\n\nINSERT { GRAPH ?g {\n?creator foaf:lastName `bif:left(str(?catalogueName), bif:strchr(str(?catalogueName), ','))`  ;\n  foaf:firstName `bif:trim(bif:subseq(str(?catalogueName), bif:strchr(str(?catalogueName), ',') + 1))` ;\n  foaf:name `bif:trim(bif:concat(bif:subseq(str(?catalogueName), bif:strchr(str(?catalogueName), ',') + 1), ' ', bif:left(str(?catalogueName), bif:strchr(str(?catalogueName), ','))))` .\n  }\n}\nWHERE {\n  GRAPH ?g {\n    ?creator a foaf:Person ;\n      radatana:catalogueName ?catalogueName .\n    FILTER(bif:strcontains(?catalogueName, ',')) .\n    FILTER NOT EXISTS {?creator foaf:name ?name}\n  }\n};\n\n\n\nSPARQL\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX radatana: <http://def.bibsys.no/xmlns/radatana/1.0#>\n\nINSERT { GRAPH ?g {\n  ?creator foaf:name ?catalogueName . \n  }\n}\nWHERE { \nGRAPH ?g {\n  ?creator a foaf:Person ;\n    radatana:catalogueName ?catalogueName .\n  FILTER NOT EXISTS { ?creator foaf:name ?name }\n  }\n};"
  }
]